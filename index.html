<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>manetter</title>
<link rel="stylesheet" href="css/kadai.css">
</head>
<body>

<!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->

<header>ManetterğŸ•Š</header>
<div>
    <div class="name"> åå‰ï¼š<input type="text" id="uname"> </div>
    <div>
        <textarea id="text" cols="30" rows="10"></textarea>
        <button id="send">ğŸ•Š</button>
    </div>
    <div class="post" id="output" style="overflow: auto; height: 300px;"></div>
</div>


<!--/ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->



<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- JQuery -->


<!--** ä»¥ä¸‹Firebase **-->
<script type="module">

import firebaseConfig from "./firebaseApikey.js";

    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getDatabase, ref, push, set, onChildAdded, remove, onChildRemoved, update, onChildChanged, get, }
    from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
   console.log(firebaseConfig);
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dbRef = ref(db,"chat");
  
    //é€ä¿¡
    $("#send").on("click",function(){

    const msg ={
       uname : $("#uname").val(),
       text : $("#text").val()
    }
  
    const newPostRef = push(dbRef); //ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ã‚’ç”Ÿæˆ
    set(newPostRef,msg);
    });
  
    onChildAdded(dbRef,function(data){
    const msg = data.val();
    const key = data.key; //ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼
  let h ='<p id="'+key+'" class="tweet">';
      h += msg.uname;
      h += '<br>';
      h += '<span contentEditable="true" id="'+key+'_update"> '+msg.text+'</span>';
      h += '<br>';
      h += '<span class="remove" data-key="'+key+'">ğŸš®</span>'
      h += '<span class="update" data-key="'+key+'">ğŸ†™</span>'
      h += '<span class="favorite" data-key="'+key+'">â˜†</span>'
      h += '</p>';
      $("#output").prepend(h);
    });

    //å‰Šé™¤ã‚¤ãƒ™
    $("#output").on("click",".remove",function(){
     const key = $(this).attr("data-key");
     const remove_item = ref(db,"chat/"+key);
     remove(remove_item); //ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
    });
  //æ›´æ–°ã‚¤ãƒ™
    $("#output").on("click",".update",function(){
      const key = $(this).attr("data-key");
      update(ref(db, "chat/"+key), {
       text: $("#"+key+'_update').html()
      });
            
    });

// â˜†ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãŠæ°—ã«å…¥ã‚Šã¨ã—ã¦ç™»éŒ²ã™ã‚‹
$("#output").on("click", ".favorite", function(){
    const key = $(this).attr("data-key");
    const favoriteRef = ref(db, "chat/"+key+"/favorite");
    get(favoriteRef).then((snapshot) => {
        if(snapshot.exists()) {
            // ãŠæ°—ã«å…¥ã‚ŠãŒæ—¢ã«å­˜åœ¨ã™ã‚‹å ´åˆã¯å‰Šé™¤
            remove(favoriteRef);
            // â­ã®çµµæ–‡å­—ã‚’è¡¨ç¤ºã™ã‚‹
            $(this).html('â­');
        } else {
            // ãŠæ°—ã«å…¥ã‚ŠãŒå­˜åœ¨ã—ãªã„å ´åˆã¯è¿½åŠ 
            set(favoriteRef, true);
            // â­ã®çµµæ–‡å­—ã‚’è¡¨ç¤ºã™ã‚‹
            $(this).html('â­');
        }
    });
});

    //å‰Šé™¤å‡¦ç†ãŒfirebaseå´ã§ã•ã‚ŒãŸã‚‰ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿï¼
    onChildRemoved(dbRef,(data)=> {
    $("#"+data.key).remove();
    });

    onChildChanged(dbRef,(data)=> {
    $("#"+data.key+'_update').html(data.val().text);
    $("#"+data.key+'_update').fadeOut(800).fadeIn(800);
    // ãŠæ°—ã«å…¥ã‚Šã®ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´
    const isFavorite = data.val().favorite ? 'â­' : 'â˜†';
    $("#"+data.key+'_favorite').text(isFavorite); // ä¿®æ­£
  });

  /*
    onChildAdded(dbRef,(snapshot)=>{
    const msg = snapshot.val();
    const key = snapshot.key(); //ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼
    let h ='<p>';
      h += msg.uname;
      h += '<br>';
      h += msg.text;
      h += '</p>';
      $("#output").append(h);
    });*/
   

  </script>











</body>
</html>
































